@model DataLayer.SpiderEditViewModel
    <div class="modal-header">
        <h6 class="modal-title" id="modalCenterTitle">
            ویرایش اسپایدر
        </h6>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <form>
        <div class="modal-body">
            <div>
                <select id="MainCategorySelect">
                    <option selected value="0">انتخاب دسته</option>
                    @foreach (var item in Model.serviceCategories)
                    {
                        <option value="@item.ID">@item.Title</option>
                    }
                </select>
                <div id="ChildCategory">

                </div>
                <input type="hidden" id="Category" value="@Model.Spider.ServiceCategory.ID" />
                <span class="text-success">دسته بندی @Model.Spider.ServiceCategory.Title</span>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="Title">عنوان</label>
                    <input type="text" class="form-control form-control-sm" id="Title" placeholder="عنوان" value="@Model.Spider.Title">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <div class="custom-file">
                        <input type="file" class="custom-file-input form-control form-control-sm" id="Image">
                        <label class="custom-file-label" for="Image" data-browse="انتخاب">@Model.Spider.Image</label>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <input type="text" value="

                       @foreach (var item in Model.Spider.SeoTages)
                               {
                           @item.Tage@:,
                               }

                               " data-role="tagsinput" id="tags" class="form-control" placeholder="کلمات کلیدی">
                </div>

            </div>


            <textarea id="my-textarea" name="Mytext">@Model.Spider.Description</textarea>

        </div>

        <div class="space"></div>
        <div class="modal-footer justify-content-end">
            <a onclick="EditSpiderUp(@Model.Spider.ID)" id="BtnEditSpider" class="btn btn-success btn-sm text-white"><i class="fas fa-edit"></i>ویرایش</a>
        </div>
    </form>
    <script src="~/Content/bootstrap/js/bootstrap-tagsinput.js"></script>
    <script>
        $(function () {
            $('#my-textarea').ckeditor();
        });

        $("#MainCategorySelect").change(function () {
            if ($("#MainCategorySelect option:selected").val() == 0) { } else {
                $.get("/Admin/ServiceCategory/P_ChildCategoryInCreate?ParentID=" + $("#MainCategorySelect option:selected").val(), function (result) {
                    $("#ChildCategory").html(result);
                    $("#Category").val($("#MainCategorySelect option:selected").val());
                });
            }
        });

        function EditSpiderUp(ID) {
            if ($("#Title").val() == null || $("#Title").val() == "" || $("#my-textarea").val() == null || $("#my-textarea").val() == "") {
                $("#BtnEditSpider").removeClass('btn-success');
                $("#BtnEditSpider").addClass('btn-danger');
                $("#BtnEditSpider").html("همه موارد اجباری میباشد");
            } else {
                $("#BtnEditSpider").addClass('btn-success');
                $("#BtnEditSpider").removeClass('btn-danger');
                $("#BtnEditSpider").html("<i class='fas fa-plus-circle'></i>افزودن");

                if ($("#Image").val() == null || $("#Image").val() == "") {

                    var tags = [];

                    //Data

                    for (var i = 0; i < $(".tag").length; i++) {
                        tags.push($(".tag")[i].innerText);
                    }
                    var Category = $("#Category").val();
                    var Title = $("#Title").val();
                    var Description = $("#my-textarea").val();

                    $.ajax({
                        type: "POST",
                        url: '/Admin/Management/SpiderEdit',
                        data: { ID: ID, Category: Category, Title: Title, Description: Description, Image: null, SeoTages: tags },
                        success: function (result) {
                            if (result == "true") {
                                $("#card-table").html("<img src='/img/gif/load.gif' class='loding justify-content-center' />");
                                $.get("/Admin/Management/P_Spider", function (result) {
                                    $(".Panel").removeClass("bg-info");
                                    $(".Panel").removeClass("text-white");
                                    $("#SpiderPaper").addClass("bg-info");
                                    $("#SpiderPaper").addClass("text-white");
                                    $("#card-table").html(result);
                                    alert("مطلب با موفقیت ویرایش شد.");
                                    $("#modalSave").css('display', 'none');
                                    $("#modalSave").removeClass('show');
                                    document.querySelectorAll('.modal-backdrop')[0].parentElement.removeChild(document.querySelectorAll('.modal-backdrop')[0]);
                                });
                            } else {
                                alert(result);
                            }
                        },
                        dataType: "json",
                        traditional: true
                    });


                } else {


                    var data = new FormData();
                    var files = $("#Image").get(0).files;
                    if (files.length > 0) {
                        data.append("UploadSpiderImage", files[0]);
                    }

                    $.ajax({
                        url: "/Admin/Upload/UploadSliderImage",
                        type: "POST",
                        processData: false,
                        contentType: false,
                        data: data,
                        success: function (response) {
                            var tags = [];

                            //Data

                            for (var i = 0; i < $(".tag").length; i++) {
                                tags.push($(".tag")[i].innerText);
                            }
                            var Category = $("#Category").val();
                            var Title = $("#Title").val();
                            var Description = $("#my-textarea").val();
                            var Image = response;
                            $.ajax({
                                type: "POST",
                                url: '/Admin/Management/SpiderEdit',
                                data: { ID: ID, Category: Category, Title: Title, Description: Description, Image: Image, SeoTages: tags },
                                success: function (result) {
                                    if (result == "true") {
                                        $("#card-table").html("<img src='/img/gif/load.gif' class='loding justify-content-center' />");
                                        $.get("/Admin/Management/P_Spider", function (result) {
                                            $(".Panel").removeClass("bg-info");
                                            $(".Panel").removeClass("text-white");
                                            $("#SpiderPaper").addClass("bg-info");
                                            $("#SpiderPaper").addClass("text-white");
                                            $("#card-table").html(result);
                                            alert("مطلب با موفقیت ویرایش شد.");
                                            $("#modalSave").removeClass('show');
                                            document.querySelectorAll('.modal-backdrop')[0].parentElement.removeChild(document.querySelectorAll('.modal-backdrop')[0]);
                                        });
                                    } else {
                                        alert(result);
                                    }
                                },
                                dataType: "json",
                                traditional: true
                            });
                        }
                    });
                }

            }
        }


    </script>

