@model DataLayer.ServiceCategory
<div class="modal-header">
    <h6 class="modal-title" id="modalCenterTitle">
        ویرایش دسته بندی
    </h6>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>
<form>
    <input type="hidden" id="ID" value="@Model.ID" />
    <input type="hidden" id="ParentID" value="@ViewBag.ParentID" />
    <div class="modal-body">
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="Title">عنوان</label>
                <input type="text" class="form-control form-control-sm" id="Title" placeholder="عنوان" value="@Model.Title">
            </div>
            <div class="form-group col-md-6">
                <label for="IsActive">فعال باشد</label>
                @if (Model.IsActive == true)
                {
                    <input type="checkbox" id="IsActive" checked />
                }
                else
                {
                    <input type="checkbox" id="IsActive" />
                }
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <div class="custom-file">
                    <input type="file" class="custom-file-input form-control form-control-sm" id="Image">
                    <label class="custom-file-label" for="Image" data-browse="انتخاب">انتخاب فایل</label>
                </div>
            </div>
        </div>
        <div class="space-half"></div>

        <textarea id="my-textarea" name="Mytext">@Model.Description</textarea>
        <div class="form-row">

        </div>
    </div>
    <div class="space"></div>
    <div class="modal-footer justify-content-end">
        <a id="EditCategory" class="btn btn-success btn-sm text-white" data-toggle="modal" data-target="#modalSave"><i class="fas fa-edit"></i>ویرایش</a>
    </div>
</form>


<script>
    $(function () {
        $('#my-textarea').ckeditor();
    });

    $("#EditCategory").click(function () {
        if ($("#Title").val() == null || $("#Title").val() == "" || $("#my-textarea").val() == null || $("#my-textarea").val() == "") {
            $("#EditCategory").html("همه موارد اجباری میباشد");
            $("#EditCategory").removeClass("btn-success");
            $("#EditCategory").addClass("btn-danger");
        } else {
            $("#EditCategory").html("<i class='fas fa-plus-circle'></i>افزودن");
            $("#EditCategory").addClass("btn-success");
            $("#EditCategory").removeClass("btn-danger");
            var ID,ParentID, Title, IsActive, mytextarea, Image;
            ParentID = $("#ParentID").val();
            Title = $("#Title").val();
            if ($("#IsActive").is(":checked")) {
                IsActive = true;
            }
            if ($("#ActiveSource").is(":not(:checked)")) {
                IsActive = false;
            }
            ID = $("#ID").val();
            mytextarea = $("#my-textarea").val();

            if ($("#Image").val() == null || $("#Image").val()) {
                $.ajax({
                    url: "/Admin/ServiceCategory/Create",
                    type: "POST",
                    processData: false,
                    contentType: false,
                    data: { ID: ID, ParentID: ParentID, Title: Title, IsActive: IsActive, Description: mytextarea, Image: null },
                    success: function (result) {
                        if (result == "true") {
                            $("#EditCategory").html("ثبت شد");
                            $("#EditCategory").addClass("btn-success");
                            $("#EditCategory").removeClass("btn-danger");
                            window.location.reload();
                        } else {
                            alert(result);
                        }
                    }
                });
            }

            var data = new FormData();

            var files = $("#Image").get(0).files;
            if (files.length > 0) {
                data.append("UploadCategoryImageFile", files[0]);
            }
            $.ajax({
                url: "/Admin/Upload/UploadCategoryImage",
                type: "POST",
                processData: false,
                contentType: false,
                data: data,
                success: function (response) {
                    Image = response;

                    $.ajax({
                        url: "/Admin/ServiceCategory/Create",
                        type: "POST",
                        processData: false,
                        contentType: false,
                        data: { ID: ID, ParentID: ParentID, Title: Title, IsActive: IsActive, Description: mytextarea, Image: Image },
                        success: function (result) {
                            if (result == "true") {
                                $("#AddCategory").html("ثبت شد");
                                $("#AddCategory").addClass("btn-success");
                                $("#AddCategory").removeClass("btn-danger");
                                window.location.reload();
                            } else {
                                alert(result);
                            }
                        }
                    });
                },
                error: function (er) {
                    alert(er);
                }

            });

        }

    });

</script>
